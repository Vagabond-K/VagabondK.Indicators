using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using VagabondK.Indicators.GeometryUtil;

namespace VagabondK.Indicators.DigitalFonts
{
    /// <summary>
    /// 가로 5개, 세로 7개로 구성된 셀 기반 디지털 문자 양식입니다.
    /// </summary>
    public abstract class Cell5x7Font : DigitalFont
    {
        private static readonly Dictionary<char, long> binaryCodes = new Dictionary<char, long>
        {
            { '0' , 0b01110100011001110101110011000101110 },
            { '1' , 0b01110001000010000100001000011000100 },
            { '2' , 0b11111000100010001000100001000101110 },
            { '3' , 0b01110100011000001100100001000101110 },
            { '4' , 0b01000010001111101001010100110001000 },
            { '5' , 0b01110100011000010000011110000111111 },
            { '6' , 0b01110100011000101111000011000101110 },
            { '7' , 0b00100001000010001000100001000111111 },
            { '8' , 0b01110100011000101110100011000101110 },
            { '9' , 0b01110100011000011110100011000101110 },

            { 'A' , 0b10001100011111110001100011000101110 },
            { 'B' , 0b01111100011000101111100011000101111 },
            { 'C' , 0b01110100010000100001000011000101110 },
            { 'D' , 0b01111100011000110001100011000101111 },
            { 'E' , 0b11111000010000101111000010000111111 },
            { 'F' , 0b00001000010000101111000010000111111 },
            { 'G' , 0b01110100011000111001000011000101110 },
            { 'H' , 0b10001100011000111111100011000110001 },
            { 'I' , 0b01110001000010000100001000010001110 },
            { 'J' , 0b00110010010100001000010000100011100 },
            { 'K' , 0b10001010010010100011001010100110001 },
            { 'L' , 0b11111000010000100001000010000100001 },
            { 'M' , 0b10001100011000110001101011101110001 },
            { 'N' , 0b10001100011100110101100111000110001 },
            { 'O' , 0b01110100011000110001100011000101110 },
            { 'P' , 0b00001000010000101111100011000101111 },
            { 'Q' , 0b10110010011010110001100011000101110 },
            { 'R' , 0b10001010010010101111100011000101111 },
            { 'S' , 0b01110100011000001110000011000101110 },
            { 'T' , 0b00100001000010000100001000010011111 },
            { 'U' , 0b01110100011000110001100011000110001 },
            { 'V' , 0b00100010101000110001100011000110001 },
            { 'W' , 0b01010101011010110101100011000110001 },
            { 'X' , 0b10001100010101000100010101000110001 },
            { 'Y' , 0b00100001000010001010100011000110001 },
            { 'Z' , 0b11111000010001000100010001000011111 },

            { 'a' , 0b11110100011111010000011100000000000 },
            { 'b' , 0b01111100011000110011011010000100001 },
            { 'c' , 0b01110100010000100001011100000000000 },
            { 'd' , 0b11110100011000111001101101000010000 },
            { 'e' , 0b01110000011111110001011100000000000 },
            { 'f' , 0b00010000100001000111000101001001100 },
            { 'g' , 0b01110100001111010001111100000000000 },
            { 'h' , 0b10001100011000110011011010000100001 },
            { 'i' , 0b01110001000010000110001000000000100 },
            { 'j' , 0b00110010010100001000011000000001000 },
            { 'k' , 0b01001001010001100101010010000100001 },
            { 'l' , 0b01110001000010000100001000010000110 },
            { 'm' , 0b10101101011010110101010110000000000 },
            { 'n' , 0b10001100011000110011011010000000000 },
            { 'o' , 0b01110100011000110001011100000000000 },
            { 'p' , 0b00001000010111110001011110000000000 },
            { 'q' , 0b10000100001111010001111100000000000 },
            { 'r' , 0b00001000010000110011011010000000000 },
            { 's' , 0b01111100000111000001011100000000000 },
            { 't' , 0b01100100100001000010001110001000010 },
            { 'u' , 0b10110110011000110001100010000000000 },
            { 'v' , 0b00100010101000110001100010000000000 },
            { 'w' , 0b01010101011010110001100010000000000 },
            { 'x' , 0b10001010100010001010100010000000000 },
            { 'y' , 0b01110100001111010001100010000000000 },
            { 'z' , 0b11111000100010001000111110000000000 },

            { '!' , 0b00100000000010000100001000010000100 },
            { '"' , 0b00000000000000000000010100101001010 },
            { '#' , 0b01010010101111101010111110101001010 },
            { '$' , 0b00100011111010001110001011111000100 },
            { '%' , 0b11000110010001000100010001001100011 },
            { '&' , 0b10110010011010100010001010100100110 },
            { '\'' , 0b00000000000000000000000000010000100 },
            { '(' , 0b01000001000001000010000100010001000 },
            { ')' , 0b00010001000100001000010000010000010 },
            { '*' , 0b00000001001010101110101010010000000 },
            { '+' , 0b00000001000010011111001000010000000 },
            { ',' , 0b00010001000011000000000000000000000 },
            { '-' , 0b00000000000000011111000000000000000 },
            { '.' , 0b00110001100000000000000000000000000 },
            { '/' , 0b00000000010001000100010001000000000 },
            { ':' , 0b00000001100011000000001100011000000 },
            { ';' , 0b00010001000011000000001100011000000 },
            { '<' , 0b01000001000001000001000100010001000 },
            { '=' , 0b00000000001111100000111110000000000 },
            { '>' , 0b00010001000100010000010000010000010 },
            { '?' , 0b00100000000010001000100001000101110 },
            { '@' , 0b01110101011010110110100001000101110 },
            { '[' , 0b01110000100001000010000100001001110 },
            { '\\' , 0b00000100000100000100000100000100000 },
            { ']' , 0b01110010000100001000010000100001110 },
            { '^' , 0b00000000000000000000100010101000100 },
            { '_' , 0b11111000000000000000000000000000000 },
            { '`' , 0b00000000000000000000010000010000010 },
            { '{' , 0b01000001000010000010001000010001000 },
            { '|' , 0b00100001000010000100001000010000100 },
            { '}' , 0b00010001000010001000001000010000010 },
            { '~' , 0b00000000000100110110000000000000000 },
            { '¡' , 0b00100001000010000100001000000000100 },
            { '¢' , 0b00100011101010100101001010111000100 },
            { '£' , 0b01101100100001001111000100001001100 },
            { '¤' , 0b00000100010111001010011101000100000 },
            { '¥' , 0b00100001001111100100111110101010001 },
            { '¦' , 0b00100001000010000000001000010000100 },
            { '§' , 0b00110010010010001010001001001001100 },
            { '¨' , 0b00000000000000000000000000000001010 },
            { '©' , 0b11111100011010111101101011000111111 },
            { 'ª' , 0b11111000001111010001111101000001110 },
            { '«' , 0b10100010100010101010101000000000000 },
            { '¬' , 0b10000100001111100000000000000000000 },
            { '®' , 0b11111101011100110001101011000111111 },
            { '¯' , 0b00000000000000000000000000000011111 },
            { '°' , 0b00000000000000000110010010100101001 },
            { '±' , 0b11111000000010000100111110010000100 },
            { '²' , 0b00000000000000001111000100010001001 },
            { '³' , 0b00000000000000000111010000011001000 },
            { '´' , 0b00000000000000000000000100010001000 },
            { 'µ' , 0b00001000011011111001100011000110001 },
            { '¶' , 0b11000110001100011110110011100111110 },
            { '·' , 0b00000000000011000110000000000000000 },
            { '¸' , 0b00110010000010000100000000000000000 },
            { '¹' , 0b00000000000000000111000100001000011 },
            { 'º' , 0b11111000000111010001100011000101110 },
            { '»' , 0b00101010101010001010001010000000000 },
            { '¼' , 0b01000111100101001101010100010101001 },
            { '½' , 0b11100010001000010101010100010101001 },
            { '¾' , 0b10000111001010011011100100001100010 },
            { '¿' , 0b01110100010000100010001000000000100 },

            { 'À' , 0b10001100011111110001011100010000100 },
            { 'Á' , 0b10001100011111110001011100010000100 },
            { 'Â' , 0b10001100011111110001011100000001010 },
            { 'Ã' , 0b10001100011111110001011100000001001 },
            { 'Ä' , 0b10001100011111110001011100010000000 },
            { 'Å' , 0b10001100011111110001011100010001010 },
            { 'Æ' , 0b11101001010010111111001010010111110 },
            { 'Ç' , 0b01100010000111010001000010000110001 },
            { 'È' , 0b11111000010111100001111110000000100 },
            { 'É' , 0b11111000010111100001111110000000100 },
            { 'Ê' , 0b11111000010111100001111110000001010 },
            { 'Ë' , 0b11111000010111100001111110000001010 },
            { 'Ì' , 0b01110001000010000100011100000000100 },
            { 'Í' , 0b01110001000010000100011100000000100 },
            { 'Î' , 0b01110001000010000100011100000001010 },
            { 'Ï' , 0b01110001000010000100011100000001010 },
            { 'Ð' , 0b01110100101001010111100101001001110 },
            { 'Ñ' , 0b10001110011010110011100010000001001 },
            { 'Ò' , 0b01110100011000110001100010111000100 },
            { 'Ó' , 0b01110100011000110001100010111000100 },
            { 'Ô' , 0b01110100011000110001011100000001010 },
            { 'Õ' , 0b01110100011000110001011100000001001 },
            { 'Ö' , 0b01110100011000110001100010111000000 },
            { '×' , 0b00000100010101000100010101000100000 },
            { 'Ø' , 0b00001011101001110101110010111010000 },
            { 'Ù' , 0b01110100011000110001100011000100100 },
            { 'Ú' , 0b01110100011000110001100011000100100 },
            { 'Û' , 0b01110100011000110001100010000001010 },
            { 'Ü' , 0b01110100011000110001100011000100000 },
            { 'Ý' , 0b00100001000010000100001000101010001 },
            { 'Þ' , 0b00111000100111010010100100111000010 },
            { 'ß' , 0b01101100101001001110100101001001100 },
            { 'à' , 0b11110100011111010000011100000000100 },
            { 'á' , 0b11110100011111010000011100000000100 },
            { 'â' , 0b11110100011111010000011100000001010 },
            { 'ã' , 0b11110100011111010000011100000001001 },
            { 'ä' , 0b11110100011111010000011100000001010 },
            { 'å' , 0b11110100011111010000011100010001010 },
            { 'æ' , 0b11110001011111010100010110000000000 },
            { 'ç' , 0b00110001000111010001000010111000000 },
            { 'è' , 0b01110000011111110001011100000000100 },
            { 'é' , 0b01110000011111110001011100000000100 },
            { 'ê' , 0b01110000011111110001011100000001010 },
            { 'ë' , 0b01110000011111110001011100000001010 },
            { 'ì' , 0b01110001000010000110001000000000100 },
            { 'í' , 0b01110001000010000110001000000000100 },
            { 'î' , 0b01110001000010000110001000000001010 },
            { 'ï' , 0b01110001000010000110001000000001010 },
            { 'ð' , 0b01110100011111001000001010001000101 },
            { 'ñ' , 0b10001100011000110011011010000001001 },
            { 'ò' , 0b01110100011000110001011100000000100 },
            { 'ó' , 0b01110100011000110001011100000000100 },
            { 'ô' , 0b01110100011000101110000000101000100 },
            { 'õ' , 0b01110100011000101110000000100110110 },
            { 'ö' , 0b01110100011000110001011100000001010 },
            { '÷' , 0b00000001000000011111000000010000000 },
            { 'ø' , 0b00001011101010110101011101000000000 },
            { 'ù' , 0b10110110011000110001100010000000100 },
            { 'ú' , 0b10110110011000110001100010000000100 },
            { 'û' , 0b10110110011000110001100010000001010 },
            { 'ü' , 0b10110110011000110001100010000001010 },
            { 'ý' , 0b01110100001111010001100010010001000 },
            { 'þ' , 0b01110001000110010100011000010000110 },
            { 'ÿ' , 0b01110100001111010001100010000001010 },
            { 'Œ' , 0b11010001010010101101001010010111010 },
            { 'œ' , 0b11010001011110110101010100000000000 },
            { 'Š' , 0b01110100001000001110000010111000100 },
            { 'š' , 0b01111100000111000001011100000000100 },
            { 'Ÿ' , 0b00100001000101010001100011000100000 },
            { 'Ž' , 0b11111000010001000100010001111100100 },
            { 'ž' , 0b11111000100010001000111110000000100 },
            { 'ƒ' , 0b00010001010010001110001001010001000 },

            { 'Α' , 0b10001100011111110001100011000101110 },
            { 'Β' , 0b01111100011000101111100011000101111 },
            { 'Γ' , 0b00001000010000100001000011000111111 },
            { 'Δ' , 0b11111100011000101010010100010000100 },
            { 'Ε' , 0b11111000010000101111000010000111111 },
            { 'Ζ' , 0b11111000010001000100010001000011111 },
            { 'Η' , 0b10001100011000111111100011000110001 },
            { 'Θ' , 0b01110100011000111111100011000101110 },
            { 'Ι' , 0b01110001000010000100001000010001110 },
            { 'Κ' , 0b10001010010010100011001010100110001 },
            { 'Λ' , 0b10001100011000101010010100010000100 },
            { 'Μ' , 0b10001100011000110101101011101110001 },
            { 'Ν' , 0b10001100011100110101100111000110001 },
            { 'Ξ' , 0b11111100010000001110000001000111111 },
            { 'Ο' , 0b01110100011000110001100011000101110 },
            { 'Π' , 0b10001100011000110001100011000111111 },
            { 'Ρ' , 0b00001000010000101111100011000101111 },
            { 'Σ' , 0b11111100010001000100000101000111111 },
            { 'Τ' , 0b00100001000010000100001000010011111 },
            { 'Υ' , 0b00100001000010001010100011000110001 },
            { 'Φ' , 0b00100011101010110101101010111000100 },
            { 'Χ' , 0b10001100010101000100010101000110001 },
            { 'Ψ' , 0b00100001000111010101101011010110101 },
            { 'Ω' , 0b11011010101000110001100010111000000 },

            { 'α' , 0b10110010010100110101100100000000000 },
            { 'β' , 0b01101100011000101101010010100100110 },
            { 'γ' , 0b00100001000010001010100011000110001 },
            { 'δ' , 0b01110100011000101010001001001001100 },
            { 'ε' , 0b01110100010011000001011100000000000 },
            { 'ζ' , 0b01000100000111000001001100100011111 },
            { 'η' , 0b10010100101001010010011010000000000 },
            { 'θ' , 0b00110010010100101111010010100100110 },
            { 'ι' , 0b11000001000010000100001000010000000 },
            { 'κ' , 0b01001001010001100101010010000000000 },
            { 'λ' , 0b10001100010101001010001000010000010 },
            { 'μ' , 0b00001000011011111001100011000110001 },
            { 'ν' , 0b00100010100101010001100010000000000 },
            { 'ξ' , 0b01000100000111000001001100000101110 },
            { 'ο' , 0b01110100011000110001011100000000000 },
            { 'π' , 0b11001010100101001010111110000000000 },
            { 'ρ' , 0b00001000010111110001100011000101110 },
            { 'ς' , 0b01000100000111000001000010111000000 },
            { 'σ' , 0b00110010010100101001111100000000000 },
            { 'τ' , 0b01000001000010000101011101000000000 },
            { 'υ' , 0b01110100011000110001010010000000000 },
            { 'φ' , 0b00100001000111010001011100010000100 },
            { 'χ' , 0b11001001010011000100011001010010011 },
            { 'ψ' , 0b00100001000111010101101011010100100 },
            { 'ω' , 0b01010101011010110001010100000000000 },

            { 'А' , 0b10001100011111110001100011000101110 },
            { 'Б' , 0b01111100011000101111000011000111111 },
            { 'В' , 0b01111100011000101111100011000101111 },
            { 'Г' , 0b00001000010000100001000011000111111 },
            { 'Д' , 0b10001111111000110010101001010011110 },
            { 'Е' , 0b11111000010000101111000010000111111 },
            { 'Ж' , 0b10101101011010101110101011010110101 },
            { 'З' , 0b01111100001000001100100001000001111 },
            { 'И' , 0b10001100011001110101110011000110001 },
            { 'Й' , 0b10001100111010111001100010010001010 },
            { 'К' , 0b10001010010010100011001010100110001 },
            { 'Л' , 0b10010101011010010100101001010011110 },
            { 'М' , 0b10001100011000110101101011101110001 },
            { 'Н' , 0b10001100011000111111100011000110001 },
            { 'О' , 0b01110100011000110001100011000101110 },
            { 'П' , 0b10001100011000110001100011000111111 },
            { 'Р' , 0b00001000010000101111100011000101111 },
            { 'С' , 0b01110100010000100001000011000101110 },
            { 'Т' , 0b00100001000010000100001000010011111 },
            { 'У' , 0b00001000100010001010100011000110001 },
            { 'Ф' , 0b00100011101010110101101010111000100 },
            { 'Х' , 0b10001100010101000100010101000110001 },
            { 'Ц' , 0b10000111111000110001100011000110001 },
            { 'Ч' , 0b10000100001000011110100011000110001 },
            { 'Ш' , 0b11111101011010110101101011010110101 },
            { 'Щ' , 0b10000111111010110101101011010110101 },

            { 'Ъ' , 0b01110100101001001110000100001000011 },
            { 'Ы' , 0b10011101011010110011100011000110001 },
            { 'Ь' , 0b01111100011000101111000010000100001 },
            { 'Э' , 0b01110100011000011010101001000101110 },
            { 'Ю' , 0b01001101011010110111101011010101001 },
            { 'Я' , 0b10001100101010011110100011000111110 },
            { 'а' , 0b11110100011111010000011100000000000 },
            { 'б' , 0b01110100011000101111000010001011100 },
            { 'в' , 0b01111100010111110001011110000000000 },
            { 'г' , 0b00001000010000100001111110000000000 },
            { 'д' , 0b10001111111001010010111000000000000 },
            { 'е' , 0b01110000011111110001011100000000000 },
            { 'ж' , 0b10101101010111010101101010000000000 },
            { 'з' , 0b01111100000111010000011110000000000 },
            { 'и' , 0b10001100111010111001100010000000000 },
            { 'й' , 0b10001100111010111001100010010001010 },
            { 'к' , 0b01001001010001100101010010000000000 },
            { 'л' , 0b10001100101001010010111100000000000 },
            { 'м' , 0b10001100011010111011100010000000000 },
            { 'н' , 0b10001100011111110001100010000000000 },
            { 'о' , 0b01110100011000110001011100000000000 },
            { 'п' , 0b10001100011000110001111110000000000 },
            { 'р' , 0b00001000010111110001011110000000000 },
            { 'с' , 0b01110100010000100001011100000000000 },
            { 'т' , 0b00100001000010000100111110000000000 },
            { 'у' , 0b00001000100010001010100010000000000 },
            { 'ф' , 0b00100001000111010101011100010000100 },
            { 'х' , 0b10001010100010001010100010000000000 },
            { 'ц' , 0b10000111110100101001010010000000000 },
            { 'ч' , 0b10000100001111010001100010000000000 },
            { 'ш' , 0b11111101011010110101101010000000000 },
            { 'щ' , 0b10000111111010110101101010000000000 },

            { '—' , 0b00000000000000011111000000000000000 },
            { '‘' , 0b00000000000000000000010000010000010 },
            { '’' , 0b00000000000000000000000100010001000 },
            { '‚' , 0b00010001000011000000000000000000000 },
            { '‛' , 0b00000000000000000000010000010000010 },
            { '“' , 0b00000000000000000000101000101000101 },
            { '”' , 0b00000000000000000000001010101010100 },
            { '„' , 0b01001100101101100000000000000000000 },
            { '†' , 0b00100001000010000100001000111000100 },
            { '•' , 0b00000000000111001110011100000000000 },
            { '…' , 0b10101000000000000000000000000000000 },
            { '‹' , 0b00000000000010000010001000000000000 },
            { '›' , 0b00000000000010001000001000000000000 },
            { '‼' , 0b01010000000101001010010100101001010 },
            { '‽' , 0b00100000000010001100101001010101110 },
            { '€' , 0b01100100100011100010001111001001100 },
            { '™' , 0b10001101011101110001001000010011111 },
            { '∞' , 0b00000000000101010101010100000000000 },

            { 'ァ' , 0b00010001000110010000111110000000000 },
            { 'ア' , 0b00010001000010001100101001000011111 },
            { 'ィ' , 0b00100001010011000100010000000000000 },
            { 'イ' , 0b00100001000010100110001000100010000 },
            { 'ゥ' , 0b01100100001000111111001000000000000 },
            { 'ウ' , 0b00100010001000010001100011111100100 },
            { 'ェ' , 0b11111001000010011111000000000000000 },
            { 'エ' , 0b11111001000010000100001000010011111 },
            { 'ォ' , 0b01001010100110011111010000000000000 },
            { 'オ' , 0b01000010010101001100010001111101000 },
            { 'カ' , 0b01001100101001010010100101111100010 },
            { 'キ' , 0b00100001000010011111001001111100100 },
            { 'ク' , 0b00110010001000010001100101111000000 },
            { 'ケ' , 0b00100010000100001000010011111000010 },
            { 'コ' , 0b11111100001000010000100001111100000 },
            { 'サ' , 0b00010001000100001010010101111101010 },
            { 'シ' , 0b00111010001000010011100000001100000 },
            { 'ス' , 0b10001010100010001000100001111100000 },
            { 'セ' , 0b11100000100001001010100101111100010 },
            { 'ソ' , 0b00110010001000010010100011000100000 },
            { 'タ' , 0b00110010001100010101100101111000000 },
            { 'チ' , 0b00010001000010011111001000011101000 },
            { 'ッ' , 0b01100100001010110101000000000000000 },
            { 'ツ' , 0b00100010001000010101101011010100000 },
            { 'テ' , 0b00010001000010000100111110000001110 },
            { 'ト' , 0b00010000100101000110000100001000010 },
            { 'ナ' , 0b00001000100010000100111110010000100 },
            { 'ニ' , 0b11111000000000000000000000111000000 },
            { 'ヌ' , 0b00001010100010001010100001111100000 },
            { 'ネ' , 0b00100101010111000100010001111100100 },
            { 'ノ' , 0b00010001000100001000010000100001000 },
            { 'ハ' , 0b10001100011000110001010000010000000 },
            { 'ヒ' , 0b11110000010000100001111110000100001 },
            { 'フ' , 0b00110010001000010000100001111100000 },
            { 'ヘ' , 0b00000100001000001000001010001000000 },
            { 'ホ' , 0b00100101011010100100001001111100100 },
            { 'マ' , 0b01000001000101010000100001111100000 },
            { 'ミ' , 0b10000011100000011110000000111000000 },
            { 'ム' , 0b10000111111000100001000100010000000 },
            { 'メ' , 0b00001010100010001010100001000000000 },
            { 'モ' , 0b11100000100001011111000101111100000 },
            { 'ャ' , 0b00010000100101010010111110001000000 },
            { 'ヤ' , 0b00010000100101010010111110001000010 },
            { 'ュ' , 0b11111010000100001110000000000000000 },
            { 'ユ' , 0b11111010000100001000010000111000000 },
            { 'ョ' , 0b01111010000111101000011110000000000 },
            { 'ヨ' , 0b11111100001000011111100001111100000 },
            { 'ラ' , 0b00100010001000010000111110000001110 },
            { 'リ' , 0b00010001000100001001010010100101001 },
            { 'ル' , 0b01101101010010100101001010010000000 },
            { 'レ' , 0b00011001010100110001000010000100000 },
            { 'ロ' , 0b11111100011000110001100011111100000 },
            { 'ワ' , 0b00100010001000010001100010111100000 },
            { 'ヲ' , 0b00100010001000011111100001111100000 },
            { 'ン' , 0b00111010001000010000000000001100000 },
            { '・' , 0b00000000000011000110000000000000000 },
            { 'ー' , 0b00000000000000011111000000000000000 },
        };
        private const int cols = 5;
        private const int rows = 7;
        private double gap = 0.12;

        /// <summary>
        /// 각 셀 사이의 틈새 크기를 가져오거나 설정합니다. 0이면 틈새가 없고 1이면 셀이 보이지 않습니다.
        /// </summary>
        [DefaultValue(0.12)]
        public double Gap { get => gap; set => SetParameter(ref gap, value); }

        /// <summary>
        /// 현재 디지털 문자 양식에서 기본 제공하는 세그먼트 상태 이진 코드를 가져옵니다. 세그먼트 상태 순서는 LSB부터 시작됩니다.
        /// </summary>
        /// <param name="character">문자</param>
        /// <returns>세그먼트 상태 이진 코드</returns>
        protected override long GetDefaultBinaryCode(char character) => binaryCodes.TryGetValue(character, out var code) ? code : 0;

        /// <summary>
        /// 특정 너비와 높이로 셀 파트 드로잉을 생성합니다. 기준점은 셀의 좌측 상단 지점입니다.
        /// </summary>
        /// <param name="width">셀 너비</param>
        /// <param name="height">셀 높이</param>
        /// <returns></returns>
        protected abstract PartDrawing CreateCellDrawing(double width, double height);

        /// <summary>
        /// 파라미터를 이용하여 세그먼트 파트 목록을 생성할 때 호출됩니다.
        /// </summary>
        /// <returns>세그먼트 파트 목록</returns>
        protected override IReadOnlyList<Part> OnCreate()
        {
            var height = Size.ToValidValue();
            var maxGap = height / (rows - 1);
            var gap = Math.Min(this.gap.ToValidValue(), 1) * maxGap;
            var cellHeight = (height - gap * (rows - 1)) / rows;
            var slantRadian = Math.Max(Math.Min(SlantAngle.ToValidValue(), 45), 0) / 180d * Math.PI;
            var pitch = WidthRatio.ToValidValue() * ((cellHeight + gap) * cols - gap);
            var cellWidth = (pitch - gap * (cols - 1)) / cols;
            var colPitch = cellWidth + gap;
            var rowPitch = cellHeight + gap;

            var skew = Transform.CreateSkew(-slantRadian, 0, 0, height);
            if (cellWidth <= 0 || cellHeight <= 0)
            {
                return Enumerable.Range(0, rows).SelectMany(row => Enumerable.Range(0, cols).Select(col => new Part(PartDrawing.Empty))).ToArray();
            }
            else
            {
                var part = CreateCellDrawing(cellWidth, cellHeight);
                return Enumerable.Range(0, rows)
                    .SelectMany(row => Enumerable.Range(0, cols)
                    .Select(col => new Part(part, Transform.CreateTranslation(col * colPitch, row * rowPitch) * skew))).ToArray();
            }
        }

        /// <summary>
        /// 대상 캐시의 모든 파라미터가 현재 캐시의 파라미터들과 같은지 여부를 가져옵니다.
        /// </summary>
        /// <param name="target">대상 캐시</param>
        /// <returns>모든 파라미터의 일치 여부</returns>
        public override bool EqualsParameters(ParametricCache<IReadOnlyList<Part>> target)
            => base.EqualsParameters(target)
            && target is Cell5x7Font parameters
            && gap.Equals(parameters.gap);

        /// <summary>
        /// 파라미터를 나타내는 문자열을 생성할 때 호출됩니다. 해당 문자열은 Hash를 생성할 때 사용되므로, 반드시 모든 파라미터의 값을 콤마 등의 구분기호로 나누어 문자열에 포합해야 합니다.
        /// </summary>
        /// <param name="stringBuilder">StringBuilder 객체</param>
        /// <returns>파라미터 문자열</returns>
        protected override StringBuilder OnGenerateParametersString(StringBuilder stringBuilder)
            => base.OnGenerateParametersString(stringBuilder)
            .Append(',').Append(gap);

        /// <summary>
        /// 디지털 문자 양식의 크기를 측정합니다.
        /// </summary>
        /// <returns>디지털 문자 양식 크기</returns>
        protected override Size Measure()
        {
            var actualHeight = Size.ToValidValue();
            var maxGap = actualHeight / (rows - 1);
            var gap = Math.Min(this.gap.ToValidValue(), 1) * maxGap;
            var cellSize = (actualHeight - gap * (rows - 1)) / rows;
            var slantRadian = Math.Max(Math.Min(SlantAngle, 45), 0) / 180d * Math.PI;
            var width = WidthRatio.ToValidValue() * ((cellSize + gap) * cols - gap);
            var actualWidth = width + Math.Tan(slantRadian) * actualHeight;

            Width = width;
            return new Size(actualWidth, actualHeight);
        }
    }
}
